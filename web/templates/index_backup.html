<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HYROX Course Correct</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/styles.css') }}">
</head>

<body>
    <div class="container">
        <header>
            <h1>üèÉ HYROX Course Correct</h1>
            <p class="subtitle">Fair cross-venue performance comparison</p>
        </header>

        <nav class="nav-tabs">
            <a href="/" class="nav-tab active">Time Converter</a>
            <a href="/analysis" class="nav-tab">Venue Analysis</a>
            <a href="/statistics" class="nav-tab">Statistics</a>
            <a href="#" class="nav-tab feedback-link" onclick="openFeedbackModal(event)">Feedback</a>
        </nav>

        <main>
            <div class="card">
                <h2>Convert Your Finish Time</h2>
                <p class="description">
                    Compare your HYROX performance across different venues by accounting for course difficulty.
                </p>

                <form id="convertForm">
                    <div class="form-group">
                        <label for="finishTime">Finish Time</label>
                        <input type="text" id="finishTime" name="finish_time" placeholder="1:15:30 or 75:30" required
                            pattern="[0-9]{1,2}:[0-9]{2}:[0-9]{2}|[0-9]{1,3}:[0-9]{2}">
                        <small>Format: HH:MM:SS or MM:SS</small>
                    </div>

                    <div class="form-group">
                        <label>Gender</label>
                        <div class="radio-group">
                            <label class="radio-label">
                                <input type="radio" name="gender" value="M" required checked>
                                <span>Men</span>
                            </label>
                            <label class="radio-label">
                                <input type="radio" name="gender" value="W" required>
                                <span>Women</span>
                            </label>
                        </div>
                        <small>Gender-specific course corrections account for venue difficulty differences</small>
                    </div>

                    <div class="form-group">
                        <label for="fromVenue">Your Venue</label>
                        <select id="fromVenue" name="from_venue" required>
                            <option value="">Select venue...</option>
                            {% for venue in venues %}
                            <option value="{{ venue }}">{{ venue }}</option>
                            {% endfor %}
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="toVenue">Convert To</label>
                        <select id="toVenue" name="to_venue" required>
                            <option value="normalized">Normalized (Reference)</option>
                            {% for venue in venues %}
                            <option value="{{ venue }}">{{ venue }}</option>
                            {% endfor %}
                        </select>
                    </div>

                    <button type="submit" class="btn-primary">Convert Time</button>
                </form>

                <div id="result" class="result hidden">
                    <h3>Converted Time</h3>
                    <div class="result-grid">
                        <div class="result-item">
                            <span class="label">Original:</span>
                            <span class="value" id="originalTime"></span>
                            <span class="venue" id="originalVenue"></span>
                        </div>
                        <div class="arrow">‚Üí</div>
                        <div class="result-item">
                            <span class="label">Converted:</span>
                            <span class="value converted" id="convertedTime"></span>
                            <span class="venue" id="convertedVenue"></span>
                        </div>
                    </div>
                    <div class="time-diff" id="timeDiff"></div>
                </div>
            </div>

            <div class="card">
                <h2>Course Correction Factors</h2>
                <p class="description">
                    Course correction factors for Season 8 (2025/2026)
                </p>
                <div class="venue-list">
                    <div class="venue-header">
                        <div>Venue</div>
                        <div style="text-align: center">Men</div>
                        <div style="text-align: center">Women</div>
                        <div style="text-align: center">Overall</div>
                    </div>

                    {% for row in venue_rows %}
                    <div class="venue-row {{ 'baseline-row' if row.is_baseline else '' }}">
                        <div class="col-name">
                            <span class="flag">{{ row.flag }}</span>
                            {{ row.name }}
                        </div>

                        <div class="col-stat">
                            {% if row.is_baseline %}
                            <span class="badge baseline">Ref</span>
                            {% else %}
                            <span class="badge {{ 'positive' if row.men_pct_val > 0 else 'negative' }}">
                                {{ row.men_display }}
                            </span>
                            {% endif %}
                        </div>

                        <div class="col-stat">
                            {% if row.is_baseline %}
                            <span class="badge baseline">Ref</span>
                            {% else %}
                            <span class="badge {{ 'positive' if row.women_pct_val > 0 else 'negative' }}">
                                {{ row.women_display }}
                            </span>
                            {% endif %}
                        </div>

                        <div class="col-stat">
                            {% if row.is_baseline %}
                            <span class="badge baseline">Ref</span>
                            {% else %}
                            <span class="badge {{ 'positive' if row.overall_pct_val > 0 else 'negative' }}">
                                {{ row.overall_display }}
                            </span>
                            {% endif %}
                        </div>
                    </div>
                    {% endfor %}
                </div>
            </div>

            <div class="info-card">
                <h3>How It Works</h3>
                <p>
                    Different HYROX venues have varying layouts, run loop lengths, and Roxzone distances.
                    This tool uses statistical modeling to calculate course correction factors that enable
                    fair performance comparisons across venues.
                </p>
                <ul>
                    <li><strong>Normalized:</strong> Your time adjusted to the reference venue (correction = 0:00)</li>
                    <li><strong>Venue-to-Venue:</strong> Convert your time to what it would be at a different venue</li>
                    <li><strong>Course Factor:</strong> Percentage showing how much harder/easier a venue is</li>
                </ul>
            </div>
        </main>

        <footer>
            <p>Built with ‚ù§Ô∏è for the HYROX community | Season 8 (2025/2026)</p>
        </footer>
    </div>

    <!-- Feedback Modal -->
    <div id="feedbackModal" class="modal hidden">
        <div class="modal-content">
            <span class="close-modal" onclick="closeFeedbackModal()">&times;</span>
            <h2>We value your feedback</h2>
            <p>Help us improve HYROX Course Correct</p>

            <form id="feedbackForm">
                <div class="form-group">
                    <label>Rating</label>
                    <div class="star-rating">
                        <input type="radio" id="star5" name="rating" value="5" /><label for="star5"
                            title="5 stars">‚òÖ</label>
                        <input type="radio" id="star4" name="rating" value="4" /><label for="star4"
                            title="4 stars">‚òÖ</label>
                        <input type="radio" id="star3" name="rating" value="3" /><label for="star3"
                            title="3 stars">‚òÖ</label>
                        <input type="radio" id="star2" name="rating" value="2" /><label for="star2"
                            title="2 stars">‚òÖ</label>
                        <input type="radio" id="star1" name="rating" value="1" /><label for="star1"
                            title="1 star">‚òÖ</label>
                    </div>
                </div>

                <div class="form-group">
                    <label for="feedbackLiked">What did you like?</label>
                    <textarea id="feedbackLiked" name="liked" rows="2"></textarea>
                </div>

                <div class="form-group">
                    <label for="feedbackLearned">What did you learn?</label>
                    <textarea id="feedbackLearned" name="learned" rows="2"></textarea>
                </div>

                <div class="form-group">
                    <label for="feedbackLacking">What is lacking?</label>
                    <textarea id="feedbackLacking" name="lacking" rows="2"></textarea>
                </div>

                <div class="form-group">
                    <label for="feedbackComments">General Comments</label>
                    <textarea id="feedbackComments" name="comments" rows="2"></textarea>
                </div>

                <button type="submit" class="btn-primary">Submit Feedback</button>
            </form>
        </div>
    </div>

    <script>
        const SHOW_FEEDBACK_POPUP = {{ 'true' if show_feedback_popup else 'false' }};
    </script>

    <script src="{{ url_for('static', filename='js/app.js') }}"></script>
</body>

</html>